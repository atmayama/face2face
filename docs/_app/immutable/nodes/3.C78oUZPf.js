import"../chunks/DsnmJJEf.js";import{i as ye}from"../chunks/BwJiMLis.js";import{w as ee,o as Ie,s as B,e as $e}from"../chunks/BXJ3ol0R.js";import{M as Se,h as V,O as Pe,i as g,a1 as Ee,Q as Te,R as Me,S as te,T as se,U as W,$ as J,a2 as Re,a3 as ke,W as G,Y as Ae,F as Ne,a4 as Ce,V as Oe,K as z,a5 as ne,a6 as ce,a7 as De,a8 as Ve,Z as de,_ as Je,a9 as He,aa as Ye,ab as K,ac as ue,ad as ze,ae as Fe,af as Le,ag as Ue,ah as qe,ai as Be,e as We,E as Ke,j as Qe,aj as Xe,x as Ze,t as F,v as oe,p as H,y as Ge,z as R,B as D,J as Y,A as k,m as je,o as ea,ak as aa,al as ra}from"../chunks/BaRsyZaw.js";import{_ as ta,s as Q,i as X,a as sa}from"../chunks/B0wkarcR.js";import{s as na}from"../chunks/7b5QLZPp.js";function oa(n,r){return r}function ia(n,r,e){for(var o=n.items,a=[],c=r.length,f=0;f<c;f++)Fe(r[f].e,a,!0);var w=c>0&&a.length===0&&e!==null;if(w){var v=e.parentNode;Le(v),v.append(e),o.clear(),M(n,r[0].prev,r[c-1].next)}Ue(a,()=>{for(var p=0;p<c;p++){var _=r[p];w||(o.delete(_.k),M(n,_.prev,_.next)),ue(_.e,!w)}})}function la(n,r,e,o,a,c=null){var f=n,w={flags:r,items:new Map,first:null};V&&Pe();var v=null,p=!1,_=new Map,P=Ee(()=>{var s=e();return De(s)?s:s==null?[]:ce(s)}),t,b;function d(){ca(b,t,w,_,f,a,r,o,e),c!==null&&(t.length===0?v?de(v):v=G(()=>c(f)):v!==null&&Je(v,()=>{v=null}))}Se(()=>{b??=qe,t=g(P);var s=t.length;if(p&&s===0)return;p=s===0;let h=!1;if(V){var E=Te(f)===Me;E!==(s===0)&&(f=te(),se(f),W(!1),h=!0)}if(V){for(var I=null,u,m=0;m<s;m++){if(J.nodeType===Re&&J.data===ke){f=J,h=!0,W(!1);break}var x=t[m],y=o(x,m);u=j(J,w,I,null,x,y,m,a,r,e),w.items.set(y,u),I=u}s>0&&se(te())}if(V)s===0&&c&&(v=G(()=>c(f)));else if(Ae()){var A=new Set,T=Ne;for(m=0;m<s;m+=1){x=t[m],y=o(x,m);var $=w.items.get(y)??_.get(y);$?fe($,x,m):(u=j(null,w,null,null,x,y,m,a,r,e,!0),_.set(y,u)),A.add(y)}for(const[N,l]of w.items)A.has(N)||T.skipped_effects.add(l.e);T.add_callback(d)}else d();h&&W(!0),g(P)}),V&&(f=J)}function ca(n,r,e,o,a,c,f,w,v){var p=r.length,_=e.items,P=e.first,t=P,b,d=null,s=[],h=[],E,I,u,m;for(m=0;m<p;m+=1){if(E=r[m],I=w(E,m),u=_.get(I),u===void 0){var x=o.get(I);if(x!==void 0){o.delete(I),_.set(I,x);var y=d?d.next:t;M(e,d,x),M(e,x,y),Z(x,y,a),d=x}else{var A=t?t.e.nodes_start:a;d=j(A,e,d,d===null?e.first:d.next,E,I,m,c,f,v)}_.set(I,d),s=[],h=[],t=d.next;continue}if(fe(u,E,m),(u.e.f&K)!==0&&de(u.e),u!==t){if(b!==void 0&&b.has(u)){if(s.length<h.length){var T=h[0],$;d=T.prev;var N=s[0],l=s[s.length-1];for($=0;$<s.length;$+=1)Z(s[$],T,a);for($=0;$<h.length;$+=1)b.delete(h[$]);M(e,N.prev,l.next),M(e,d,N),M(e,l,T),t=T,d=l,m-=1,s=[],h=[]}else b.delete(u),Z(u,t,a),M(e,u.prev,u.next),M(e,u,d===null?e.first:d.next),M(e,d,u),d=u;continue}for(s=[],h=[];t!==null&&t.k!==I;)(t.e.f&K)===0&&(b??=new Set).add(t),h.push(t),t=t.next;if(t===null)continue;u=t}s.push(u),d=u,t=u.next}if(t!==null||b!==void 0){for(var i=b===void 0?[]:ce(b);t!==null;)(t.e.f&K)===0&&i.push(t),t=t.next;var S=i.length;if(S>0){var C=null;ia(e,i,C)}}n.first=e.first&&e.first.e,n.last=d&&d.e;for(var O of o.values())ue(O.e);o.clear()}function fe(n,r,e,o){Ce(n.v,r),n.i=e}function j(n,r,e,o,a,c,f,w,v,p,_){var P=(v&He)!==0,t=(v&Ye)===0,b=P?t?z(a,!1,!1):ne(a):a,d=(v&Ve)===0?f:ne(f),s={i:d,v:b,k:c,a:null,e:null,prev:e,next:o};try{if(n===null){var h=document.createDocumentFragment();h.append(n=Oe())}return s.e=G(()=>w(n,b,d,p),V),s.e.prev=e&&e.e,s.e.next=o&&o.e,e===null?_||(r.first=s):(e.next=s,e.e.next=s.e),o!==null&&(o.prev=s,o.e.prev=s.e),s}finally{}}function Z(n,r,e){for(var o=n.next?n.next.e.nodes_start:e,a=r?r.e.nodes_start:e,c=n.e.nodes_start;c!==null&&c!==o;){var f=ze(c);a.before(c),c=f}}function M(n,r,e){r===null?n.first=e:(r.next=e,r.e.next=e&&e.e),e!==null&&(e.prev=r,e.e.prev=r&&r.e)}function ie(n,r,e){Be(()=>{var o=We(()=>r(n,e?.())||{});if(e&&o?.update){var a=!1,c={};Ke(()=>{var f=e();Qe(f),a&&Xe(c,f)&&(c=f,o.update(f))}),a=!0}if(o?.destroy)return()=>o.destroy()})}const da=!1,$a=Object.freeze(Object.defineProperty({__proto__:null,prerender:da},Symbol.toStringTag,{value:"Module"})),ua=()=>{const n=na;return{page:{subscribe:n.page.subscribe},navigating:{subscribe:n.navigating.subscribe},updated:n.updated}},fa={subscribe(n){return ua().page.subscribe(n)}},ve=ee(null),me=ee(null),va=ee(!1);function le(n){return new Promise((r,e)=>{ta(async()=>{const{default:o}=await import("../chunks/BxLQoAyG.js");return{default:o}},[],import.meta.url).then(({default:o})=>{const a=new o(n||"",{});a.on("open",c=>{console.log("PeerJS open:",c),ve.set(a),me.set(c),va.set(!0),r(a)}),a.on("error",c=>{console.error("PeerJS error:",c),e(c)}),a.on("disconnected",()=>{console.log("PeerJS disconnected")}),a.on("close",()=>{console.log("PeerJS close")})})})}var ma=F('<div><h2 class="text-xl font-semibold">Your Video</h2> <video autoplay class="w-full h-auto bg-black"></video></div>',2),pa=F('<button class="px-4 py-2 bg-blue-500 text-white rounded-md mt-4">Switch Camera</button>'),_a=F('<div><h2 class="text-xl font-semibold"> </h2> <video autoplay class="w-full h-auto bg-black"></video></div>',2),ha=F('<div class="container mx-auto p-4"><h1 class="text-2xl font-bold mb-4"> </h1> <p> </p> <div class="grid grid-cols-1 md:grid-cols-2 gap-4"><!> <!> <!></div></div>');function Sa(n,r){Ze(r,!1);const[e,o]=sa(),a=()=>Q(fa,"$page",e),c=()=>Q(ve,"$peer",e),f=()=>Q(me,"$peerId",e),w=a().url.searchParams.get("action");let v=z(),p=z(new Map),_=new Map,P="user",t=z(!1);function b(l,i){return l.srcObject=i,{update(S){l.srcObject=S},destroy(){}}}async function d(l){try{const i=await navigator.mediaDevices.getUserMedia({video:{facingMode:l,width:320,height:240,frameRate:10},audio:{frameRate:10}});Y(v,i)}catch(i){console.error("Error accessing media devices:",i)}}async function s(){P=P==="user"?"environment":"user",await d(P),console.log("Toggled camera. New localStream:",g(v));for(const l of _.values()){const i=g(v).getVideoTracks()[0];if(i){const S=l.peerConnection.getSenders().find(C=>C.track?.kind==="video");S?(S.replaceTrack(i),console.log("Replaced track for peer:",l.peer,"with new track:",i)):console.warn("No video sender found for peer:",l.peer)}else console.warn("No video track found in localStream after camera toggle.")}}Ie(async()=>{Y(t,window.innerWidth<=768),w==="create"?await le(a().url.searchParams.get("roomId")):await le(),await d(P),console.log("Initial localStream on mount:",g(v));const l=c();if(l&&(l.on("call",i=>{i.answer(g(v)),i.on("stream",S=>{g(p).set(i.peer,S),Y(p,g(p))}),_.set(i.peer,i)}),a().url.searchParams.get("roomId")&&l.id!==a().url.searchParams.get("roomId"))){const i=l.call(a().url.searchParams.get("roomId"),g(v));i&&(i.on("stream",S=>{g(p).set(a().url.searchParams.get("roomId"),S),Y(p,g(p))}),_.set(a().url.searchParams.get("roomId"),i))}}),ye();var h=ha(),E=R(h),I=R(E);k(E);var u=D(E,2),m=R(u);k(u);var x=D(u,2),y=R(x);{var A=l=>{var i=ma(),S=D(R(i),2);ie(S,(C,O)=>b?.(C,O),()=>g(v)),k(i),H(l,i)};X(y,l=>{g(v)&&l(A)})}var T=D(y,2);{var $=l=>{var i=pa();$e("click",i,s),H(l,i)};X(T,l=>{g(t)&&l($)})}var N=D(T,2);la(N,1,()=>[...g(p).entries()],oa,(l,i,S,C)=>{var O=aa(()=>ra(g(i),2));let pe=()=>g(O)[0],ae=()=>g(O)[1];var re=je(),_e=ea(re);{var he=L=>{var U=_a(),q=R(U),ge=R(q);k(q);var be=D(q,2);ie(be,(we,xe)=>b?.(we,xe),ae),k(U),oe(()=>B(ge,`Remote Video from ${pe()??""}`)),H(L,U)};X(_e,L=>{ae()&&L(he)})}H(l,re)}),k(x),k(h),oe(l=>{B(I,`Room: ${l??""}`),B(m,`Your Peer ID: ${f()??""}`)},[()=>a().url.searchParams.get("roomId")]),H(n,h),Ge(),o()}export{Sa as component,$a as universal};
